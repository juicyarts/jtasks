- job-template:
    name: 'comon-{name}'
    project-type: freestyle
    display-name: "Comon || {disName}"
    default: global
    disabled: false
    concurrent: false
    description: |
        A Job that tests comon {name}
    workspace: /home/ubuntu/jenkins/public_html
    scm:
        - git:
            url: ssh://ubuntu@git.endstand.de/comon.git
            wipe-workspace: false
            force-polling-using-workspace: true
            credentials-id: 'cc9e5f62-47bf-42e6-8842-340e7982f1f5'
            branches:
                - '{branch}'
            basedir: comon
            included-regions:
                - comon/prj/{path}/.*
            excluded-regions:
                - comon/prj/{path}/docs/.*
    triggers:
        - pollscm:
            cron: "H/3 * * * *"
    builders:
        - shell: |
            cd comon/prj && yarn install
        - shell: |
            cd comon/prj/{path}/ && gulp test
    properties:
        - build-discarder:
            num-to-keep: 5
    wrappers:
        - ansicolor:
            colormap: xterm
    publishers:
        - slack-notification:
            rooms: '#jenkins'
        - junit:
            results: comon/prj/{path}/docs/junit/**/*.xml
        - cobertura:
            report-file: comon/prj/{path}/docs/coverage/cobertura-coverage.xml
            only-stable: "true"
            fail-no-reports: "true"
            fail-unhealthy: "true"
            fail-unstable: "true"
            health-auto-update: "true"
            stability-auto-update: "true"
            zoom-coverage-chart: "true"
            source-encoding: "Big5"
            targets:
                - files:
                    healthy: 10
                    unhealthy: 20
                    failing: 30
                - method:
                    healthy: 50
                    unhealthy: 40
                    failing: 30
        - html-publisher:
            name: "Docs"
            dir: "comon/prj/{path}/docs/documentation/jsdoc"
            files: "index.html"
            keep-all: true
            allow-missing: true
            link-to-last-build: true
        - html-publisher:
            name: "Galen"
            dir: "comon/prj/{path}/docs/galenreport/demo.js"
            files: "index.html"
            keep-all: true
            allow-missing: true
            link-to-last-build: true
        - html-publisher:
            name: "Mochawesome"
            dir: "comon/prj/{path}/mochawesome-reports/"
            files: "mochawesome.html"
            keep-all: true
            allow-missing: true
            link-to-last-build: true
 
- project:
    name: tasks
    disName: 'Tasks || Testing'
    path: tasks
    branch: 'p-ads/develop'
    jobs:
        - 'comon-{name}'
    properties:
        - build-discarder:
            num-to-keep: 5
        - slack:
            notify-start: true
            notify-success: true
            notify-aborted: true
            notify-notbuilt: true
            notify-unstable: true
            notify-failure: true
            notify-backtonormal: true
            notify-repeatedfailure: true
            include-test-summary: true
            show-commit-list: true
            room: '#jenkins'
            token: 'y0BZ3zJ261oYaMUlhjvaf206'
            team-domain: heimspiel
- publisher:
    name: slack-notification
    publishers:
        - slack:
            team-domain: 'heimspiel'
            auth-token: 'y0BZ3zJ261oYaMUlhjvaf206'
            build-server-url: 'http://ci01.crunchtime.net:8888/'
            room: '{rooms}'
            notify-start: true
            notify-success: true
            notify-aborted: true
            notify-notbuilt: true
            notify-unstable: true
            notify-failure: true
            notify-backtonormal: true
            notify-repeatedfailure: true
            include-test-summary: true
